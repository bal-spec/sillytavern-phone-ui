# Changelog

## 1.3.0

### New Features

- **Save to gallery button**: Per-image download button (top-right corner, appears on hover) saves the current image to the character gallery. Tracks saved state per carousel variant — saved images show a permanent dimmed checkmark and cannot be saved again. State persists across reloads.
- **Skip gallery by default**: Images generated by the extension use `gallery=false` to avoid cluttering the character gallery. Backwards-compatible with SillyTavern release (parameter is silently ignored on older versions).

### Bug Fixes

- **Auto-restore on page reload**: Images and voice notes now restore automatically when a chat is loaded, using the `CHAT_CHANGED` event. The `/phone-ui` slash command is no longer needed after page reload.
- **Fix diagonal spinner drift**: The overlay spinner during variant generation drifted diagonally due to a CSS `transform` conflict between `translate()` centering and `rotate()` animation. Switched to `margin: auto` centering.

### Improvements

- **Bolder overlay buttons**: All image overlay buttons (carousel arrows, edit, gallery save) increased from 28px to 36px with higher contrast backgrounds for better visibility.
- **Remove loading placeholder spinner**: Removed the loading spinner shown during initial image generation in favor of SillyTavern's built-in toast notification.

## 1.2.1

### Security

- **Sanitize slash command arguments**: Image prompts and voice note text passed to `/imagine` and `/speak` are now sanitized to prevent pipe `|` characters from being interpreted as command chaining by SillyTavern's slash command parser.
- **Escape voice name in `/speak`**: Strip double quotes from the character name to prevent quote breakout in the voice parameter.
- **Escape image URL in HTML**: Image `src` attributes are now HTML-escaped to prevent attribute injection from crafted URLs in stored chat data.

## 1.2.0

### Bug Fixes

- **Fix duplicate VN player rendering**: When the LLM's inline placeholder HTML didn't match what `findPlaceholder` expected, the extension would append a working player at the bottom while the static placeholder remained visible. Now uses a multi-tier fallback (saved ref → broadened search → VN position marker → append) and cleans up orphan placeholders after insertion.

### Known Issues

- ~~**Restore on page reload fails silently**~~: Fixed in 1.3.0.

## 1.1.0

### New Features

- **Image prompt editor**: Pencil edit button overlaid on images (appears on hover) opens an inline editor to modify the prompt. "Save" updates the prompt; "Save & Generate" regenerates the image with the new prompt.
- **Voice notes**: `[VN]...[/VN]` tags are replaced with interactive waveform players that play back via TTS using the character's voice. Includes an edit button to modify the speech text and re-play.
- **`/phone-ui` slash command**: Manually re-process all character messages when the extension fails to trigger automatically.
- **Spinner overlay**: A spinning indicator is shown on the dimmed image during variant generation (carousel right arrow and Save & Generate).
- **Voice note loading state**: Play button shows a spinner while TTS is rendering.
- **Duration estimate**: Voice note player displays an estimated duration based on word count.

### Improvements

- Updated installation docs with SillyTavern UI install method (paste repo URL).
- Added troubleshooting entry for manually re-triggering the extension.

## 1.0.0

- Initial release
- Image generation from `[IMG]` tags with carousel navigation and variant generation
- Media persistence in chat history via `message.extra.phoneMedia`
- Restore on reload without re-generating
